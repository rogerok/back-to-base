# Инварианты

Инвариант в программировании — логическое выражение, определяющее непротиворечивость состояния (набора данных).

Инвариант — это контракт целостности состояния, который код обязан поддерживать во всех наблюдаемых точках.

Инварианты = границы допустимого мира
Инварианты отрезают от этого множества всё недопустимое.

```
Все возможные состояния
└── допустимые (инварианты выполняются)
              └── реально достижимые через API
```

Хорошая абстракция:

- не позволяет создать недопустимое состояние

- не позволяет наблюдать недопустимое состояние

Пример 1: пользователь и авторизация

Инварианты

```
user.isAuthenticated === true
⇒ user.token != null
⇒ user.id != null
```

Плохой код (инвариант размазан)

```ts
if (user?.token) {
  if (user.id) {
    showProfile();
  }
}
```

Каждый участок кода перестраховывается, потому что:

нет гарантий

никто не знает, в каком состоянии данные

Хороший код (инвариант зашит в абстракцию)

```ts
const user = getCurrentUser();

user.id; // всегда есть
user.token; // всегда есть
```

Пример 2: async-данные и UI

Инварианты состояния загрузки

```
state === "loading"
⇒ data == null
⇒ error == null

state === "success"
⇒ data != null

state === "error"
⇒ error != null

```

Когда инвариантов нет

```ts
if (loading && data) { ... } // ❓
if (!loading && !error) { ... } // ❓

```

Когда инварианты есть

```ts
switch (state) {
  case "loading":
    showLoading();
  case "success":
    render(data);
  case "error":
    showError(error);
}
```

Инварианты — это правила здоровья данных

Абстракции существуют, чтобы гарантировать их

Прямые мутации = нарушение контракта

Хороший код не проверяет всё подряд, он опирается на обещания
